# 自动战斗辅助

## 简介

- 演示视频：https://www.bilibili.com/video/BV12P411H7yp

- 自动战斗辅助可以按照设定的角色、策略、优先级、触发条件等自动切换角色和执行攻击，使用元素战技和元素爆发。

- 按下`/`以启动或结束自动战斗辅助。

- 需要原神以1080p窗口化运行。不建议设置色彩滤镜。

- 需要设置team.json文件，设置方法如下所示。

## 使用方法

1. 下载tags里最新版本的GIA.zip并解压
2. 启动原神后，以管理员权限运行GIA.exe

## 策略组 tastic

自动战斗辅助支持以下策略：
| 策略关键字 | 说明 |
| ----- | ---- |
| `>`|立刻跳转至下一组|
| `@e?A:B`|元素战技是否生效。生效执行A，否则执行B。|
| `e?A:B`|元素战技是否就绪。就绪执行A，否则执行B。|
| `q?A:B`|元素爆发是否就绪。就绪执行A，否则执行B。|
|`#@e?A:B`|元素战技是否就绪，如果就绪，循环执行A,否则执行B。|
| `a`/`a~`| 普通攻击/重击|
| `e`/`e~`| 使用元素战技（点按/长按）|
| `j`| 跳跃|
| `ja`|跳跃攻击|
| `sp`|冲刺|
| `r`| 瞄准|
| `rr`|快速瞄准两次|
| 数字|延时，单位为`毫秒`|

每个策略关键字用`,`分隔；不同策略组用`;`分隔。当一组策略执行完毕后，执行下一个策略组。

注意：

- 在判断表达式中，策略关键字之间用`.`分隔。
- 不能添加空格。

含有`?`的策略关键字用法与三元运算符相近，如：

`@e?e:a;`：当元素战技准备时执行e，否则执行a。

`@e?e.a.a:none;`：当元素战技准备时执行`e,a,a`，否则不执行。

其中，`none` 可以为其他任何无意义字符，表示不执行任何动作。

注意：

- 判断表达式中，不能嵌套判断表达式；
- 判断表达式最好以分号结束，后面不再接策略关键字。

示例：
|角色|策略|
|----|----|
|zhongli|`e?e~:none;q?q:none`|
|yunjin|`e?e~:none;q?q:none`|
|yoimiya|`e?e:none;#@e?a:q;`|

## 触发器 trigger

触发器条件成立时，允许切换至该角色。
|触发器|说明|
|----|----|
|`e_ready`|当角色的元素战技准备就绪时，可以切换|
|`q_ready`|当角色的元素爆发准备就绪时，可以切换|
|`idle`|始终触发|

当多个角色的触发条件成立时，切换角色的顺序由优先级决定。

## 优先级 priority

优先级从小到大依次降低，0为最高优先级。
优先级可以同级。

## 其他设置

|设置项|介绍|
|----|----|
|`Elast_time`|E技能持续时间，没有则为0|
|`E_short_cd_time`|短E持续时间，不能为0|
|`E_long_cd_time`|长E持续时间，没有则为0|
|`Ecd_float_time`|在E技能冷却还有x秒前即切换至该角色，可以为0|
|`n`|角色在队伍中的位置（1~4），不可重复，不可为0|

## 角色元素战技、元素爆发图片设置

当imgs/ 目录下有角色的q技能、e技能图片时，可以优化程序运行。

1. 角色队列的Q技能图片

    此项为空时，`q_ready`将永远为ture。

    设置方法：如果imgs文件夹内没有该角色的图片时：
    1. 在角色的q技能准备就绪时，切换至任意其他角色；
    2. 运行 character_snapshot.exe， 根据提示操作；
    3. 在outputimgs文件夹内，找到图片`character_listq_n.png`，将`character`改为该角色的名称，删除`_n`。
    4. 将图片移动到genshin-impact-assistant/imgs文件夹内。

2. 角色 Q技能图片

    此项为空时，`q?`将永远为ture。

    设置方法：如果imgs文件夹内没有该角色的图片时：
    1. 在角色的q技能准备就绪时，切换至该角色；
    2. 运行 character_snapshot.exe， 根据提示操作；
    3. 在outputimgs文件夹内，找到图片`character_q.png`，将`character`改为该角色的名称
    4. 将图片移动到genshin-impact-assistant/imgs文件夹内。

3. 角色 E技能图片

    此项为空时，为保证程序运行稳定，角色的元素战技释放流畅性将受到限制。

    设置方法：如果imgs文件夹内没有该角色的图片时：
    1. 在角色的e技能准备就绪时，切换至该角色；
    2. 运行 character_snapshot.exe， 根据提示操作；
    3. 在outputimgs文件夹内，找到图片`character_e.png`，将`character`改为该角色的名称
    4. 将图片移动到genshin-impact-assistant/imgs文件夹内。

4. 其他注意事项

    - 程序启动后若无反应可按一下回车   
    
    - 角色名称可在`config/character_dist.json`中查找，每个角色的首项即为该角色名称，其余为角色别名，如：

        `["albedo","Albedo","阿贝多","アルベド"]`中，角色名称为`albedo`，其他为别名。

    - character_snapshot.exe 运行后，在准备完成后按下回车，在控制台将会看到`clolr:xxx`。请确认该项的数字与

        [34,215,150](角色血量健康 或[102,102,255](角色血量较低 接近。

        否则，请确认运行环境：

        - 1080p 窗口化
        - 无色彩滤镜

        如果无法解决问题，可提交issue。

    - 角色血量过低或有角色死亡时，程序暂停运行。
    - 不在合适的界面时，程序暂停运行。

## team.json文件示例

以宵宫、钟离、班尼特、云堇队伍为例：

[文件示例1](./team_example.json)
